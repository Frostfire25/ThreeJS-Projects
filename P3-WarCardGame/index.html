<html>
<head>
    <title>(Project 3) War Card Game</title>
    <!--"Blocker" Code Grabbed from: https://threejs.org/examples/misc_controls_pointerlock.html -->
    <style>
     
    </style>
</head>
<body>


<canvas id="myCanvas"></canvas>

<script type="module">

import { OrbitControls } from "http://cs.merrimack.edu/~stuetzlec/three.js-master/examples/jsm/controls/OrbitControls.js";

// Objects & Functions
// Gets a random number
// https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Math/random
function getRandomArbitrary(min, max) {
  return Math.random() * (max - min) + min;
}

// Gets a random integer
// https://stackoverflow.com/questions/1527803/generating-random-whole-numbers-in-javascript-in-a-specific-range
function getRandomArbitraryInt(min, max) {
    min = Math.ceil(min);
    max = Math.floor(max);
    return Math.floor(Math.random() * (max - min + 1)) + min;
}

/**
 * Asteroid Blitzer 
 * By Derek Costello and Alexander Elguezabl
 * 
 * Please host a server to run the project, we are hosting textures.
 * 
 * Two Cool Features:
 *  - Added looping game music
 *  - Asteroids explode on-contact
 *  - Asteroids have a small texture
 * 
 * Our resterization technique used is Depth Test on smaller asteroids that are created when a large one is colided with.
 * Along with scisoring for the rear-view plane.
 * 
 * If you have any questions please let us know!
 * 
 */

// Start of Javascript code
import * as THREE from "http://cs.merrimack.edu/~stuetzlec/three.js-master/build/three.module.js";
import { ConvexGeometry } from "http://cs.merrimack.edu/~stuetzlec/three.js-master/examples/jsm/geometries/ConvexGeometry.js";
import { DragControls } from 'http://cs.merrimack.edu/~stuetzlec/three.js-master/examples/jsm/controls/DragControls'
import { PointerLockControls } from 'http://cs.merrimack.edu/~stuetzlec/three.js-master/examples/jsm/controls/PointerLockControls'

/**
 * Initilization function, creating scene, camera, and objects.
 */
// Creating Scene
var scene = new THREE.Scene();
//scene.fog = new THREE.FogExp2( 0xefd1b5, 0.0005 );

// Renderer 
var renderer = new THREE.WebGLRenderer({canvas: myCanvas, antialias: true});
//renderer.setClearColor( 0xffffff, 1 );
//renderer.setClearColor( new THREE.Color( 'aqua' ), 1 );
// If you want this to span the window, instead of using the myCanvas object, use the window object
renderer.setPixelRatio(window.devicePixelRatio * 1.01);
renderer.setSize(window.innerWidth, window.innerHeight * 1);
renderer.setClearColor(0x000000);
renderer.shadowMap.enabled = true;
renderer.shadowMap.type = THREE.PCFSoftShadowMap;

// Automiattically adjusts video based on resize.
document.body.appendChild( renderer.domElement );
window.addEventListener( 'resize', function() {
    var width = window.innerWidth;
    var height = window.innerHeight;
    renderer.setSize( width, height );
});

// Adding a camera
var camera = new THREE.PerspectiveCamera( 35, window.innerWidth / window.innerHeight, .1, 3000 );
camera.position.set(50, 50, 50);  // Try moving this around!
camera.lookAt( new THREE.Vector3(0.0,0.0,0.0));
scene.add( camera );

// Light
var light = new THREE.AmbientLight( 0x404040, 5 )
//light.position.set( 0, 0, camera.position.z );
//light.castShadow = true;            // default false
//light.shadow.mapSize.width = 1024;  // default 512
//light.shadow.mapSize.height = 1024; // default 512
//light.shadow.camera.near = 2;       // default 0.5
//light.shadow.camera.far = 1500;  
scene.add( light );


// Texture loader
const loader = new THREE.TextureLoader();
const cardColor = new THREE.Color( 'white' );

// Card object class
function Card( name, filename, value, suit ) {

    this.name = name;
    this.fileName = filename;
    this.value = value;
    this.suit = suit;

    this.init = function() {
        
        this.geometry = new THREE.BoxGeometry( 0.1, 7, 3 );
        this.texture = new THREE.MeshStandardMaterial({
                                            color: cardColor,
                                            map: loader.load(this.fileName)
                                        });
        this.card = new THREE.Mesh( this.geometry, this.texture ); 
    }

}

// Table object class
function Table(filename) {
    this.fileName = filename;
    this.texture;

    this.init = function() {

        // Build the table top
        var topGeom = new THREE.BoxGeometry(60, 1, 60);
        // Texture loading credit: https://threejs.org/examples/webgl_lights_physical.html
        var topMat = new THREE.MeshStandardMaterial({
            roughness: 0.8,
            color: 0xffffff,
            metalness: 0.2,
            bumpScale: 0.0005
        });
        loader.load( 'three.js-master/examples/textures/hardwood2_diffuse.jpg', function ( map ) {

            map.wrapS = THREE.RepeatWrapping;
            map.wrapT = THREE.RepeatWrapping;
            map.anisotropy = 4;
            map.repeat.set( 3, 3 );
            map.encoding = THREE.sRGBEncoding;
            topMat.map = map;
            topMat.needsUpdate = true;

        } );
        loader.load( 'three.js-master/examples/textures/hardwood2_bump.jpg', function ( map ) {

            map.wrapS = THREE.RepeatWrapping;
            map.wrapT = THREE.RepeatWrapping;
            map.anisotropy = 4;
            map.repeat.set( 3, 3 );
            topMat.bumpMap = map;
            topMat.needsUpdate = true;

        } );
        loader.load( 'three.js-master/examples/textures/hardwood2_roughness.jpg', function ( map ) {

            map.wrapS = THREE.RepeatWrapping;
            map.wrapT = THREE.RepeatWrapping;
            map.anisotropy = 4;
            map.repeat.set( 3, 3 );
            topMat.roughnessMap = map;
            topMat.needsUpdate = true;

        } );
        this.tableTop = new THREE.Mesh(topGeom, topMat);

        // Build the table legs
        

        // Add to the scene
        scene.add(this.tableTop);

        // Move the table to the right location
        this.tableTop.position.y = -5
    }
}

const table = new Table('./media/table/green_felt.jpg');
table.init();

// Init all cards
var cards = [];

cards.push(new Card("2_of_clubs", `./media/cards/2_of_clubs.jpg`, 2, "clubs"));
cards.push(new Card("2_of_diamonds", `./media/cards/2_of_diamonds.jpg`, 2, "diamonds"));
cards.push(new Card("2_of_spades", `./media/cards/2_of_spades.jpg`, 2, "spades"));
cards.push(new Card("2_of_hearts", `./media/cards/2_of_hearts.jpg`, 2, "hearts"));

cards.push(new Card("3_of_clubs", `./media/cards/3_of_clubs.jpg`, 3, "clubs"));
cards.push(new Card("3_of_diamonds", `./media/cards/3_of_diamonds.jpg`, 3, "diamonds"));
cards.push(new Card("3_of_spades", `./media/cards/3_of_spades.jpg`, 3, "spades"));
cards.push(new Card("3_of_hearts", `./media/cards/3_of_hearts.jpg`, 3, "hearts"));

cards.push(new Card("4_of_clubs", `./media/cards/4_of_clubs.jpg`, 4, "clubs"));
cards.push(new Card("4_of_diamonds", `./media/cards/4_of_diamonds.jpg`, 4, "diamonds"));
cards.push(new Card("4_of_spades", `./media/cards/4_of_spades.jpg`, 4, "spades"));
cards.push(new Card("4_of_hearts", `./media/cards/4_of_hearts.jpg`, 4, "hearts"));

cards.push(new Card("5_of_clubs", `./media/cards/5_of_clubs.jpg`, 5, "clubs"));
cards.push(new Card("5_of_diamonds", `./media/cards/5_of_diamonds.jpg`, 5, "diamonds"));
cards.push(new Card("5_of_spades", `./media/cards/5_of_spades.jpg`, 5, "spades"));
cards.push(new Card("5_of_hearts", `./media/cards/5_of_hearts.jpg`, 5, "hearts"));

cards.push(new Card("6_of_clubs", `./media/cards/6_of_clubs.jpg`, 6, "clubs"));
cards.push(new Card("6_of_diamonds", `./media/cards/6_of_diamonds.jpg`, 6, "diamonds"));
cards.push(new Card("6_of_spades", `./media/cards/6_of_spades.jpg`, 6, "spades"));
cards.push(new Card("6_of_hearts", `./media/cards/6_of_hearts.jpg`, 6, "hearts"));

cards.push(new Card("6_of_clubs", `./media/cards/6_of_clubs.jpg`, 6, "clubs"));
cards.push(new Card("6_of_diamonds", `./media/cards/6_of_diamonds.jpg`, 6, "diamonds"));
cards.push(new Card("6_of_spades", `./media/cards/6_of_spades.jpg`, 6, "spades"));
cards.push(new Card("6_of_hearts", `./media/cards/6_of_hearts.jpg`, 6, "hearts"));

cards.push(new Card("7_of_clubs", `./media/cards/7_of_clubs.jpg`, 7, "clubs"));
cards.push(new Card("7_of_diamonds", `./media/cards/7_of_diamonds.jpg`, 7, "diamonds"));
cards.push(new Card("7_of_spades", `./media/cards/7_of_spades.jpg`, 7, "spades"));
cards.push(new Card("7_of_hearts", `./media/cards/7_of_hearts.jpg`, 7, "hearts"));

cards.push(new Card("8_of_clubs", `./media/cards/8_of_clubs.jpg`, 8, "clubs"));
cards.push(new Card("8_of_diamonds", `./media/cards/8_of_diamonds.jpg`, 8, "diamonds"));
cards.push(new Card("8_of_spades", `./media/cards/8_of_spades.jpg`, 8, "spades"));
cards.push(new Card("8_of_hearts", `./media/cards/8_of_hearts.jpg`, 8, "hearts"));

cards.push(new Card("9_of_clubs", `./media/cards/9_of_clubs.jpg`, 9, "clubs"));
cards.push(new Card("9_of_diamonds", `./media/cards/9_of_diamonds.jpg`, 9, "diamonds"));
cards.push(new Card("9_of_spades", `./media/cards/9_of_spades.jpg`, 9, "spades"));
cards.push(new Card("9_of_hearts", `./media/cards/9_of_hearts.jpg`, 9, "hearts"));

cards.push(new Card("jack_of_clubs", `./media/cards/jack_of_clubs.jpg`, 10, "clubs"));
cards.push(new Card("jack_of_diamonds", `./media/cards/jack_of_diamonds.jpg`, 10, "diamonds"));
cards.push(new Card("jack_of_spades", `./media/cards/jack_of_spades.jpg`, 10, "spades"));
cards.push(new Card("jack_of_hearts", `./media/cards/jack_of_hearts.jpg`, 10, "hearts"));

cards.push(new Card("queen_of_clubs", `./media/cards/queen_of_clubs.jpg`, 11, "clubs"));
cards.push(new Card("queen_of_diamonds", `./media/cards/queen_of_diamonds.jpg`, 11, "diamonds"));
cards.push(new Card("queen_of_spades", `./media/cards/queen_of_spades.jpg`, 11, "spades"));
cards.push(new Card("queen_of_hearts", `./media/cards/queen_of_hearts.jpg`, 11, "hearts"));

cards.push(new Card("king_of_clubs", `./media/cards/king_of_clubs.jpg`, 12, "clubs"));
cards.push(new Card("king_of_diamonds", `./media/cards/king_of_diamonds.jpg`, 12, "diamonds"));
cards.push(new Card("king_of_spades", `./media/cards/king_of_spades.jpg`, 12, "spades"));
cards.push(new Card("king_of_hearts", `./media/cards/king_of_hearts.jpg`, 12, "hearts"));

cards.push(new Card("ace_of_clubs", `./media/cards/ace_of_clubs.jpg`, 13, "clubs"));
cards.push(new Card("ace_of_diamonds", `./media/cards/ace_of_diamonds.jpg`, 13, "diamonds"));
cards.push(new Card("ace_of_spades", `./media/cards/ace_of_spades.jpg`, 13, "spades"));
cards.push(new Card("ace_of_hearts", `./media/cards/ace_of_hearts.jpg`, 13, "hearts"));

// Initilize all cards
cards.forEach((card) => {
    card.init();
});

const controls = new OrbitControls( camera, renderer.domElement );
controls.update();

scene.add( cards[0].card );
var priorCard = cards[0].card;

document.addEventListener('keypress', keypressed);

function keypressed( event )
{
    switch(event.key) {
        case "c": {
            // Changes the card out.
            scene.remove( priorCard );
            priorCard = cards[getRandomArbitraryInt(0, cards.length - 1)].card;

            scene.add( priorCard );
        }
    }		
}

function animate() {
    priorCard.rotation.y += 0.0075;

    requestAnimationFrame(animate);
    render();
}

function render() {
    renderer.render( scene , camera );
}

animate();

</script>

</body>
</html>